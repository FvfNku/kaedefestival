(()=>{
  const position={
  	1:{
  		"多目的室":{
  			left:0.03408,
  			top:0.02284,
  			width:0.07029,
  			height:0.11563
  		},
  		"技術室":{
  			left:0.13632,
  			top:0.02284,
  			width:0.07029,
  			height:0.11563
  		},
  		"生徒ホール":{
  			left:0.03408,
  			top:0.18201,
  			width:0.13845,
  			height:0.13847
  		},
  		"進路相談室":{
  			left:0.03408,
  			top:0.31834,
  			width:0.07029,
  			height:0.06995
  		},
  		"技術員室":{
  			left:0.03408,
  			top:0.38687,
  			width:0.07029,
  			height:0.02427
  		},
  		"事務室":{
  			left:0.03408,
  			top:0.40971,
  			width:0.07029,
  			height:0.06995
  		},
  		"校長室":{
  			left:0.03408,
  			top:0.47823,
  			width:0.07029,
  			height:0.04711
  		},
  		"応接室":{
  			left:0.03408,
  			top:0.5232,
  			width:0.07029,
  			height:0.04711
  		},
  		"会議室":{
  			left:0.03408,
  			top:0.56888,
  			width:0.07029,
  			height:0.11492
  		},
  		"保健室":{
  			left:0.03408,
  			top:0.68308,
  			width:0.07029,
  			height:0.09208
  		},
  		"WC":[
  			{
  				left:0.13632,
  				top:0.13704,
  				width:0.07029,
  				height:0.04711
  			},
  			{
  				left:0.61129,
  				top:0.27338,
  				width:0.07029,
  				height:0.04711
  			},
  			{
  				left:0.17039,
  				top:0.61456,
  				width:0.06922,
  				height:0.04711
  			},
  			{
  				left:0.27157,
  				top:0.91006,
  				width:0.06709,
  				height:0.02427
  			}
  		],
  		"図書室":{
  			left:0.23749,
  			top:0.13704,
  			width:0.17252,
  			height:0.11492
  		},
  		"社会科室":{
  			left:0.40788,
  			top:0.18201,
  			width:0.13845,
  			height:0.06995
  		},
  		"被服室":{
  			left:0.54313,
  			top:0.18201,
  			width:0.13845,
  			height:0.06995
  		},
  		"被服準備室":{
  			left:0.67945,
  			top:0.18201,
  			width:0.07029,
  			height:0.06995
  		},
  		"調理室":{
  			left:0.7476,
  			top:0.25054,
  			width:0.1033,
  			height:0.06995
  		},
  		"調理準備室":{
  			left:0.67945,
  			top:0.27338,
  			width:0.07029,
  			height:0.04711
  		},
  		"小会議室2":{
  			left:0.54313,
  			top:0.3419,
  			width:0.07029,
  			height:0.0464
  		},
  		"教育相談室":{
  			left:0.47604,
  			top:0.36403,
  			width:0.06922,
  			height:0.02427
  		},
  		"教育本部":{
  			left:0.44196,
  			top:0.34118,
  			width:0.03621,
  			height:0.04711
  		},
  		"昇降口":{
  			left:0.27157,
  			top:0.34118,
  			width:0.17252,
  			height:0.04711
  		},
  		"生徒本部":{
  			left:0.23749,
  			top:0.34118,
  			width:0.03621,
  			height:0.04711
  		},
  		"購買室":{
  			left:0.17039,
  			top:0.34118,
  			width:0.06922,
  			height:0.06995
  		},
  		"倉庫1":{
  			left:0.17039,
  			top:0.40971,
  			width:0.06922,
  			height:0.02427
  		},
  		"倉庫2":{
  			left:0.17039,
  			top:0.43255,
  			width:0.06922,
  			height:0.02427
  		},
  		"倉庫3":{
  			left:0.27157,
  			top:0.88722,
  			width:0.07029,
  			height:0.02427
  		},
  		"職員玄関":{
  			left:0.17039,
  			top:0.45539,
  			width:0.06922,
  			height:0.0464
  		},
  		"配膳室":{
  			left:0.17039,
  			top:0.66024,
  			width:0.06922,
  			height:0.04711
  		},
  		"ユネスコ":{
  			left:0.20234,
  			top:0.25696,
  			width:0.07029,
  			height:0.01713
  		},
  		"三校饅頭":{
  			left:0.27476,
  			top:0.25625,
  			width:0.08094,
  			height:0.01856
  		},
  		"案内所":{
  			left:0.35783,
  			top:0.25625,
  			width:0.07348,
  			height:0.01784
  		},
  		"飲み物販売":{
  			left:0.43557,
  			top:0.25553,
  			width:0.09691,
  			height:0.01999
  		},
  		"ピロティー":{
  			left:0.3738,
  			top:0.86438,
  			width:0.13845,
  			height:0.06995
  		},
  		"多目的ホール":{
  			left:0.51012,
  			top:0.86438,
  			width:0.17146,
  			height:0.06995
  		},
  		"トレーニングルーム":{
  			left:0.57721,
  			top:0.77373,
  			width:0.10437,
  			height:0.06995
  		},
  		"剣道場":{
  			left:0.47604,
  			top:0.77373,
  			width:0.10437,
  			height:0.06995
  		},
  		"柔道場":{
  			left:0.3738,
  			top:0.77373,
  			width:0.10437,
  			height:0.06995
  		},
  		"ポテトもち":{
  			left:0.28541,
  			top:0.7823,
  			width:0.07881,
  			height:0.03783
  		},
  		"ブライトホール":{
  			left:0.64537,
  			top:0.43255,
  			width:0.20554,
  			height:0.25125
  		},
  		"金券":{
  			left:0.30671,
  			top:4.28194,
  			width:0.06816,
  			height:-3.83369
  		},
  		"受付":{
  			left:0.52396,
  			top:0.42327,
  			width:0.05005,
  			height:0.04568
  		},
  		"巨大壁画":{
  			left:0.24494,
  			top:0.50036,
  			width:0.03088,
  			height:0.07066
  		}
  	},
  	2:{
  		"総合実践室":{
  			left:0.03423,
  			top:0.00785,
  			width:0.1722,
  			height:0.1116
  		},
  		"書道準備室":{
  			left:0.13589,
  			top:0.1177,
  			width:0.07054,
  			height:0.02354
  		},
  		"WC":[
  			{
  				left:0.13589,
  				top:0.13949,
  				width:0.07054,
  				height:0.02354
  			},
  			{
  				left:0.61203,
  				top:0.25022,
  				width:0.0695,
  				height:0.04534
  			},
  			{
  				left:0.17012,
  				top:0.58065,
  				width:0.07054,
  				height:0.04534
  			}
  		],
  		"1A":{
  			left:0.03423,
  			top:0.20575,
  			width:0.07054,
  			height:0.06713
  		},
  		"1B":{
  			left:0.03423,
  			top:0.27201,
  			width:0.07054,
  			height:0.06713
  		},
  		"1C":{
  			left:0.03423,
  			top:0.33827,
  			width:0.07054,
  			height:0.06713
  		},
  		"1D":{
  			left:0.03423,
  			top:0.40366,
  			width:0.07054,
  			height:0.068
  		},
  		"2A":{
  			left:0.03423,
  			top:0.46992,
  			width:0.07054,
  			height:0.068
  		},
  		"2B":{
  			left:0.03423,
  			top:0.53618,
  			width:0.07054,
  			height:0.068
  		},
  		"2C":{
  			left:0.03423,
  			top:0.60157,
  			width:0.07054,
  			height:0.068
  		},
  		"2D":{
  			left:0.03423,
  			top:0.66783,
  			width:0.07054,
  			height:0.068
  		},
  		"職員室":{
  			left:0.23755,
  			top:0.1177,
  			width:0.1722,
  			height:0.1116
  		},
  		"職員準備室":{
  			left:0.40768,
  			top:0.16129,
  			width:0.07054,
  			height:0.068
  		},
  		"講義室":{
  			left:0.47614,
  			top:0.16129,
  			width:0.10373,
  			height:0.068
  		},
  		"生物室":{
  			left:0.5778,
  			top:0.16129,
  			width:0.10477,
  			height:0.068
  		},
  		"生物準備室":{
  			left:0.67946,
  			top:0.16129,
  			width:0.07054,
  			height:0.068
  		},
  		"化学室":{
  			left:0.74793,
  			top:0.22755,
  			width:0.10373,
  			height:0.068
  		},
  		"化学準備室":{
  			left:0.67946,
  			top:0.25022,
  			width:0.07054,
  			height:0.04446
  		},
  		"物理室":{
  			left:0.40768,
  			top:0.31561,
  			width:0.13693,
  			height:0.04621
  		},
  		"物理準備室":{
  			left:0.54357,
  			top:0.31561,
  			width:0.07054,
  			height:0.04621
  		},
  		"地学室":{
  			left:0.23755,
  			top:0.31561,
  			width:0.10477,
  			height:0.04621
  		},
  		"地学準備室":{
  			left:0.34025,
  			top:0.33827,
  			width:0.0695,
  			height:0.02354
  		},
  		"倉庫1":{
  			left:0.17012,
  			top:0.31561,
  			width:0.07054,
  			height:0.02354
  		},
  		"倉庫2":{
  			left:0.27178,
  			top:0.84481,
  			width:0.10477,
  			height:0.04534
  		},
  		"更衣室":{
  			left:0.17012,
  			top:0.33827,
  			width:0.07054,
  			height:0.04534
  		},
  		"放送室":{
  			left:0.17012,
  			top:0.38187,
  			width:0.07054,
  			height:0.04621
  		},
  		"配膳室":{
  			left:0.17012,
  			top:0.62424,
  			width:0.07054,
  			height:0.04534
  		},
  		"部室":{
  			left:0.27178,
  			top:0.73409,
  			width:0.10477,
  			height:0.02354
  		},
  		"体育館":{
  			left:0.37344,
  			top:0.73409,
  			width:0.30809,
  			height:0.15606
  		},
  		"ブライトホール":{
  			left:0.64523,
  			top:0.40366,
  			width:0.20643,
  			height:0.24412
  		},
  		"金券":{
  			left:0.07261,
  			top:0.1918,
  			width:0.04253,
  			height:0.01221
  		}
  	},
  	3:{
  		"6A":{
  			left:0.03543,
  			top:0.23595,
  			width:0.07389,
  			height:0.07425
  		},
  		"6B":{
  			left:0.03543,
  			top:0.30812,
  			width:0.07389,
  			height:0.07495
  		},
  		"6C":{
  			left:0.03543,
  			top:0.38099,
  			width:0.07389,
  			height:0.07425
  		},
  		"6D":{
  			left:0.03543,
  			top:0.45385,
  			width:0.07389,
  			height:0.07425
  		},
  		"3A":{
  			left:0.03543,
  			top:0.52672,
  			width:0.07389,
  			height:0.07425
  		},
  		"3B":{
  			left:0.03543,
  			top:0.59958,
  			width:0.07389,
  			height:0.07425
  		},
  		"3C":{
  			left:0.03543,
  			top:0.67245,
  			width:0.07389,
  			height:0.07425
  		},
  		"3D":{
  			left:0.03543,
  			top:0.74462,
  			width:0.07389,
  			height:0.07495
  		},
  		"音楽室":{
  			left:0.24798,
  			top:0.13879,
  			width:0.17814,
  			height:0.12283
  		},
  		"パソコン室":{
  			left:0.42409,
  			top:0.18668,
  			width:0.14474,
  			height:0.07495
  		},
  		"視聴覚室":{
  			left:0.56579,
  			top:0.18668,
  			width:0.14372,
  			height:0.07495
  		},
  		"視聴覚準備室":{
  			left:0.70749,
  			top:0.18668,
  			width:0.07287,
  			height:0.07495
  		},
  		"LL室":{
  			left:0.77834,
  			top:0.25954,
  			width:0.1083,
  			height:0.07425
  		},
  		"LL準備室":{
  			left:0.7419,
  			top:0.28452,
  			width:0.03846,
  			height:0.04927
  		},
  		"倉庫1":{
  			left:0.70749,
  			top:0.28452,
  			width:0.03745,
  			height:0.04927
  		},
  		"WC":[
  			{
  				left:0.63664,
  				top:0.28452,
  				width:0.07287,
  				height:0.04927
  			},
  			{
  				left:0.21255,
  				top:0.3567,
  				width:0.03745,
  				height:0.04997
  			},
  			{
  				left:0.17713,
  				top:0.64816,
  				width:0.07287,
  				height:0.04997
  			}
  		],
  		"美術室":{
  			left:0.42409,
  			top:0.3567,
  			width:0.14474,
  			height:0.04997
  		},
  		"美術準備室":{
  			left:0.56579,
  			top:0.3567,
  			width:0.07287,
  			height:0.04997
  		},
  		"講義室":{
  			left:0.24798,
  			top:0.3567,
  			width:0.1083,
  			height:0.04997
  		},
  		"講義準備室":{
  			left:0.35324,
  			top:0.38099,
  			width:0.07287,
  			height:0.02568
  		},
  		"更衣室":{
  			left:0.17713,
  			top:0.3567,
  			width:0.03846,
  			height:0.04997
  		},
  		"配膳室":{
  			left:0.17713,
  			top:0.69604,
  			width:0.07287,
  			height:0.05066
  		}
  	},
  	4:{
  		"5A":{
  			left:0.04055,
  			top:0.19778,
  			width:0.08538,
  			height:0.08119
  		},
  		"5B":{
  			left:0.04055,
  			top:0.27759,
  			width:0.08538,
  			height:0.08119
  		},
  		"5C":{
  			left:0.04055,
  			top:0.3567,
  			width:0.08538,
  			height:0.08119
  		},
  		"5D":{
  			left:0.04055,
  			top:0.43581,
  			width:0.08538,
  			height:0.08189
  		},
  		"4A":{
  			left:0.04055,
  			top:0.51561,
  			width:0.08538,
  			height:0.08189
  		},
  		"4B":{
  			left:0.04055,
  			top:0.59473,
  			width:0.08538,
  			height:0.08119
  		},
  		"4C":{
  			left:0.04055,
  			top:0.67453,
  			width:0.08538,
  			height:0.08119
  		},
  		"4D":{
  			left:0.04055,
  			top:0.75364,
  			width:0.08538,
  			height:0.08119
  		},
  		"更衣室":{
  			left:0.20384,
  			top:0.30396,
  			width:0.08431,
  			height:0.02845
  		},
  		"倉庫1":{
  			left:0.20384,
  			top:0.33033,
  			width:0.08431,
  			height:0.02845
  		},
  		"WC":[
  			{
  				left:0.20384,
  				top:0.3567,
  				width:0.08431,
  				height:-0.31853
  			},
  			{
  				left:0.20384,
  				top:0.64816,
  				width:0.08431,
  				height:0.05482
  			}
  		]
  	}
  };
  const doc=document;
  const highlight=doc.getElementsByClassName("highlight"),
    imgId=["","firstFloor","secondFloor","thirdFloor","fourthFloor"];
  const getNum=str=>+str.replace("px","");
  const mapLink=doc.getElementsByClassName("mapLink"), l=mapLink.length;
  let animation;
  for(let i=0;i<l;i++)
    mapLink[i].addEventListener("click",function(){
      if(animation)cancelAnimationFrame(animation);//ダブルクリック対策
      const room=this.dataset.room.split("/"),
        pos=position[room[0]][room[1]],
        img=doc.getElementById(imgId[room[0]]),
        imgStyle=getComputedStyle(img),//表示されてるstyleを取得,img.styleはcssで指定した値
        imgWidth=getNum(imgStyle.width),
        imgHeight=getNum(imgStyle.height),
        startPos=window.pageYOffset,
        newPos={top:pos.top*imgHeight, left:pos.left*imgWidth, height:pos.height*imgHeight, width:pos.width*imgWidth},
        diff=img.getBoundingClientRect().top+newPos.top-window.innerHeight/2-newPos.height/2,//scrollする量(px)
        duration=Math.min(Math.abs(diff/3), 500);// 割る3は調整
      let start=0;
      const smoothScroll=time=>{
          if(!start)start=time;
          const persent=(time-start)/duration;
          if(persent>1){
            window.scroll(0,diff+startPos);
            return highlightFnc();
          }
          window.scroll(0,-diff*persent*(persent-2)+startPos);
          window.requestAnimationFrame(smoothScroll);
        };
      const highlightFnc=()=>{
          const blur=Math.min(newPos.height, newPos.width)/8;
          let css="top:"+(newPos.top+blur/2)+"px;";
          css+="left:"+(newPos.left+blur/2)+"px;";
          css+="height:"+(newPos.height-blur)+"px;";
          css+="width:"+(newPos.width-blur)+"px;";
          //+-blurは調整
          css+="filter:blur("+blur+"px);";
          highlight[+room[0]-1].setAttribute("style",css);
          animation=undefined;
        };
      animation=window.requestAnimationFrame(smoothScroll);
    });
})();
